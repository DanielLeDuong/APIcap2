"use strict";function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _objectWithoutProperties(e,r){if(null==e)return{};var t,n,o=_objectWithoutPropertiesLoose(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],0<=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function _objectWithoutPropertiesLoose(e,r){if(null==e)return{};var t,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],0<=r.indexOf(t)||(o[t]=e[t]);return o}var RegisterModel=require("../ApiUser/Register"),jwt=require("jsonwebtoken"),authController={register:function(r,t){var n,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(new RegisterModel({username:r.body.username,password:r.body.password,confirmPassword:r.body.confirmPassword,email:r.body.email}));case 3:return n=e.sent,e.next=6,regeneratorRuntime.awrap(n.save());case 6:o=e.sent,t.status(200).json(o),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.status(500).json(e.t0);case 13:case"end":return e.stop()}},null,null,[[0,10]])},login:function(r,t){var n,o,s,c,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(RegisterModel.findOne({username:r.body.username}));case 3:(n=e.sent)?n.password===r.body.password?(o=jwt.sign({id:n.id,role:n.role},"accessKey",{expiresIn:"1200s"}),s=jwt.sign({id:n.id,role:n.role},"refreshKey",{expiresIn:"6d"}),t.cookie("refreshToken",s,{httpOnly:!0,secure:!1,path:"/",sameSite:"strict"}),c=n._doc,c.password,c.confirmPassword,a=_objectWithoutProperties(c,["password","confirmPassword"]),t.status(200).json(_objectSpread({},a,{accessToken:o}))):t.json("The password is incorrect"):t.json("No existed username"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t.status(500).json(e.t0);case 10:case"end":return e.stop()}},null,null,[[0,7]])},requestRefreshToken:function(r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r.cookie.refreshToken;case 1:case"end":return e.stop()}})},logout:function(e,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r.clearCookie("refreshToken"),r.status(200).json("Log out successfully");case 2:case"end":return e.stop()}})}};module.exports=authController;
//# sourceMappingURL=authController.min.js.map
